{"version":3,"sources":["../src/hooks/use-searchable-list-data.ts"],"sourcesContent":["import {useMemo} from 'react';\nimport {type Collection, OrderedSet, Seq, type Set} from 'immutable';\nimport {type Key} from 'react-stately';\nimport useFuse from '@/hooks/use-fuse.ts';\nimport useImmutableListData, {\n\ttype ImmutableListData,\n\ttype ImmutableListOptions,\n} from '@/hooks/use-immutable-list-data.ts';\n\nexport type SearchableListOptions<T> = {\n\treadonly searchKeys?: Collection.Indexed<string>;\n} & ImmutableListOptions<T>;\n\nexport type SearchableListData<T> = {\n\treadonly filteredKeys: Set<Key>;\n} & ImmutableListData<T>;\n\nexport default function useSearchableListData<\n\tT extends Record<string, unknown>,\n>(options: SearchableListOptions<T>): SearchableListData<T> {\n\tconst {\n\t\tsearchKeys,\n\t\tgetKey = (value: T) => {\n\t\t\tif (Object.hasOwn(value, 'id')) {\n\t\t\t\treturn value.id as Key;\n\t\t\t}\n\n\t\t\tif (Object.hasOwn(value, 'key')) {\n\t\t\t\treturn value.key as Key;\n\t\t\t}\n\n\t\t\tthrow new Error(\n\t\t\t\t'searchable list data item does not have an id or key attribute, and getKey is undefined',\n\t\t\t);\n\t\t},\n\t} = options;\n\n\tconst listData = useImmutableListData(options);\n\n\tconst {items, selectedKeys, filterText} = listData;\n\n\tconst fuse = useFuse(items, {\n\t\tkeys: searchKeys?.toArray(),\n\t});\n\n\tconst filteredKeys = useMemo(() => {\n\t\tif (selectedKeys === 'all') {\n\t\t\treturn OrderedSet<Key>();\n\t\t}\n\n\t\tif (fuse === undefined || filterText === '') {\n\t\t\treturn Seq(items)\n\t\t\t\t.map(item => getKey(item))\n\t\t\t\t.toOrderedSet()\n\t\t\t\t.subtract(selectedKeys);\n\t\t}\n\n\t\tconst results = OrderedSet(\n\t\t\tfuse.search(filterText).map(result => getKey(result.item)),\n\t\t);\n\n\t\treturn results.subtract(selectedKeys);\n\t}, [selectedKeys, fuse, filterText, items, getKey]);\n\n\treturn {\n\t\t...listData,\n\t\tfilteredKeys,\n\t};\n}\n"],"mappings":";;;;;;;;AAAA,SAAQ,eAAc;AACtB,SAAyB,YAAY,WAAoB;AAgB1C,SAAR,sBAEL,SAA0D;AAC3D,QAAM;AAAA,IACL;AAAA,IACA,SAAS,CAAC,UAAa;AACtB,UAAI,OAAO,OAAO,OAAO,IAAI,GAAG;AAC/B,eAAO,MAAM;AAAA,MACd;AAEA,UAAI,OAAO,OAAO,OAAO,KAAK,GAAG;AAChC,eAAO,MAAM;AAAA,MACd;AAEA,YAAM,IAAI;AAAA,QACT;AAAA,MACD;AAAA,IACD;AAAA,EACD,IAAI;AAEJ,QAAM,WAAW,qBAAqB,OAAO;AAE7C,QAAM,EAAC,OAAO,cAAc,WAAU,IAAI;AAE1C,QAAM,OAAO,QAAQ,OAAO;AAAA,IAC3B,MAAM,YAAY,QAAQ;AAAA,EAC3B,CAAC;AAED,QAAM,eAAe,QAAQ,MAAM;AAClC,QAAI,iBAAiB,OAAO;AAC3B,aAAO,WAAgB;AAAA,IACxB;AAEA,QAAI,SAAS,UAAa,eAAe,IAAI;AAC5C,aAAO,IAAI,KAAK,EACd,IAAI,UAAQ,OAAO,IAAI,CAAC,EACxB,aAAa,EACb,SAAS,YAAY;AAAA,IACxB;AAEA,UAAM,UAAU;AAAA,MACf,KAAK,OAAO,UAAU,EAAE,IAAI,YAAU,OAAO,OAAO,IAAI,CAAC;AAAA,IAC1D;AAEA,WAAO,QAAQ,SAAS,YAAY;AAAA,EACrC,GAAG,CAAC,cAAc,MAAM,YAAY,OAAO,MAAM,CAAC;AAElD,SAAO;AAAA,IACN,GAAG;AAAA,IACH;AAAA,EACD;AACD;","names":[]}