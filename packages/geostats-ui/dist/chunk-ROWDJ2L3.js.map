{"version":3,"sources":["../src/list-prioritizer.tsx"],"sourcesContent":["import React, {useMemo, useState} from 'react';\nimport {Map, Seq} from 'immutable';\nimport {type Key} from 'react-stately';\nimport DragHandle from '@material-design-icons/svg/round/drag_handle.svg';\nimport Remove from '@material-design-icons/svg/round/remove.svg';\nimport Spacer from '@/spacer.tsx';\nimport Button from '@/button/button.tsx';\nimport useReorderableListState, {\n\ttype ReorderableListStateProps,\n} from '@/hooks/use-reorderable-list-state.ts';\nimport {cx} from '@/cva.ts';\n\nexport type ListPrioritizerProps<T extends Record<string, unknown>> = {\n\treadonly onRemove: (key: Key) => void;\n\treadonly className?: string;\n} & ReorderableListStateProps<T>;\n\nexport default function ListPrioritizer<T extends Record<string, unknown>>(\n\tprops: ListPrioritizerProps<T>,\n) {\n\tconst {onRemove, className} = props;\n\n\tconst {collection, reorder} = useReorderableListState(props);\n\n\tconst [dragStartY, setDragStartY] = useState(0);\n\n\tconst [deltaY, setDeltaY] = useState(0);\n\n\tconst [activityReferences, setActivityReferences] =\n\t\tuseState<Map<Key, HTMLDivElement>>(Map());\n\n\tconst [draggedActivity, setDraggedActivity] = useState<Key | undefined>();\n\n\tconst handleMove = (deltaY: number, key: Key) => {\n\t\tsetDeltaY(deltaY);\n\n\t\tconst previousKey = collection.getKeyBefore(key);\n\t\tif (previousKey !== null && previousKey !== undefined) {\n\t\t\tconst previousContainer = activityReferences.get(key);\n\t\t\tif (\n\t\t\t\tpreviousContainer !== undefined &&\n\t\t\t\tdeltaY < -(previousContainer.clientHeight / 2)\n\t\t\t) {\n\t\t\t\tsetDragStartY(previousContainer.getBoundingClientRect().y);\n\t\t\t\tsetDeltaY(0);\n\t\t\t\treorder(key, previousKey);\n\t\t\t}\n\t\t}\n\n\t\tconst nextKey = collection.getKeyAfter(key);\n\t\tif (nextKey !== null && nextKey !== undefined) {\n\t\t\tconst nextContainer = activityReferences.get(key);\n\t\t\tif (\n\t\t\t\tnextContainer !== undefined &&\n\t\t\t\tdeltaY > nextContainer.clientHeight\n\t\t\t) {\n\t\t\t\tsetDragStartY(\n\t\t\t\t\tnextContainer.getBoundingClientRect().y +\n\t\t\t\t\t\tnextContainer.clientHeight / 2,\n\t\t\t\t);\n\t\t\t\tsetDeltaY(0);\n\t\t\t\treorder(key, undefined, nextKey);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst touchStartHandler = (key: Key) => (event: React.TouchEvent) => {\n\t\tsetDraggedActivity(key);\n\t\tconst rect = event.currentTarget.getBoundingClientRect();\n\t\tsetDragStartY(rect.y + rect.height / 2);\n\t};\n\n\tconst dragStartHandler = (key: Key) => (event: React.DragEvent) => {\n\t\tevent.dataTransfer.setDragImage(new Image(), 0, 0);\n\t\tsetDraggedActivity(key);\n\t\tconst rect = event.currentTarget.getBoundingClientRect();\n\t\tsetDragStartY(rect.y + rect.height / 2);\n\t};\n\n\tconst touchHandler = (key: Key) => (event: React.TouchEvent) => {\n\t\tif (event.touches.length !== 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst deltaY = event.touches[0].clientY - dragStartY;\n\n\t\thandleMove(deltaY, key);\n\t};\n\n\tconst dragHandler = (key: Key) => (event: React.DragEvent) => {\n\t\tif (event.clientY === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst deltaY = event.clientY - dragStartY;\n\n\t\thandleMove(deltaY, key);\n\t};\n\n\tconst dragEndHandler = () => {\n\t\tsetDraggedActivity(undefined);\n\t\tsetDragStartY(0);\n\t\tsetDeltaY(0);\n\t};\n\n\tconst draggedActivityOffset = useMemo(() => {\n\t\tif (draggedActivity === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (draggedActivity === collection.getFirstKey() && deltaY < 0) {\n\t\t\treturn '0px';\n\t\t}\n\n\t\tif (draggedActivity === collection.getLastKey() && deltaY > 0) {\n\t\t\treturn '0px';\n\t\t}\n\n\t\treturn `${deltaY}px`;\n\t}, [collection, deltaY, draggedActivity]);\n\n\treturn (\n\t\t<div\n\t\t\tclassName={cx(\n\t\t\t\t'grow basis-5/12 border border-stone-700 rounded divide-stone-700 divide-y',\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t>\n\t\t\t{Seq(collection).map(activity => (\n\t\t\t\t<div\n\t\t\t\t\tkey={activity.key}\n\t\t\t\t\tclassName='relative'\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\theight:\n\t\t\t\t\t\t\tdraggedActivity === activity.key\n\t\t\t\t\t\t\t\t? `${activityReferences.get(activity.key)?.clientHeight ?? 0}px`\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref={element => {\n\t\t\t\t\t\t\tif (element !== null) {\n\t\t\t\t\t\t\t\tsetActivityReferences(current =>\n\t\t\t\t\t\t\t\t\tcurrent.set(activity.key, element),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclassName={cx(\n\t\t\t\t\t\t\tdraggedActivity === activity.key &&\n\t\t\t\t\t\t\t\t'absolute z-10 bg-stone-900 w-full border-y border-stone-700',\n\t\t\t\t\t\t\tdraggedActivity === undefined &&\n\t\t\t\t\t\t\t\t'hover:bg-stone-900',\n\t\t\t\t\t\t\t'flex items-center gap-4 rounded grow text-stone-200 p-2 group select-none left-0',\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\ttop:\n\t\t\t\t\t\t\t\tdraggedActivity === activity.key\n\t\t\t\t\t\t\t\t\t? draggedActivityOffset\n\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tdraggable\n\t\t\t\t\t\t\tclassName='cursor-grab touch-none fill-stone-400'\n\t\t\t\t\t\t\tonTouchStart={touchStartHandler(activity.key)}\n\t\t\t\t\t\t\tonTouchMove={touchHandler(activity.key)}\n\t\t\t\t\t\t\tonTouchEnd={dragEndHandler}\n\t\t\t\t\t\t\tonDragStart={dragStartHandler(activity.key)}\n\t\t\t\t\t\t\tonDrag={dragHandler(activity.key)}\n\t\t\t\t\t\t\tonDragEnd={dragEndHandler}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<DragHandle />\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{activity.rendered}\n\t\t\t\t\t\t<Spacer />\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName='bg-transparent hover:bg-stone-700'\n\t\t\t\t\t\t\tvariant='text'\n\t\t\t\t\t\t\tonPress={() => {\n\t\t\t\t\t\t\t\tonRemove(activity.key);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Remove className='fill-current' />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t))}\n\t\t</div>\n\t);\n}\n"],"mappings":"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","names":["deltaY"]}